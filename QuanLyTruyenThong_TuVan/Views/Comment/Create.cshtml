@model QuanLyTruyenThong_TuVan.Models.Comment

@{
    ViewData["Title"] = "Tạo góp ý mới";
}

<h1>Tạo góp ý mới</h1>

<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label class="control-label">Tên người gửi</label>
                <input class="form-control" value="@ViewBag.ResidentName" readonly />
            </div>
            <div class="form-group">
                <label asp-for="Title" class="control-label"></label>
                <input asp-for="Title" class="form-control" />
                <span asp-validation-for="Title" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Content" class="control-label"></label>
                <textarea asp-for="Content" class="form-control"></textarea>
                <span asp-validation-for="Content" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Type" class="control-label"></label>
                <select asp-for="Type" class="form-control" asp-items="@ViewBag.CommentTypes">
                    <option value="">Chọn loại góp ý</option>
                </select>
                <span asp-validation-for="Type" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ImageUrl" class="control-label">Hình ảnh (tùy chọn)</label>
                <input type="file" name="Image" class="form-control" accept="image/*" onchange="previewFile(this)" />
                <span asp-validation-for="ImageUrl" class="text-danger"></span>
            </div>
            <!-- Ảnh mới sẽ hiển thị ở đây -->
            <div id="newImagePreview" class="mb-3" style="display: none;">
                <label class="form-label fw-medium">Ảnh xem trước:</label>
                <br>
                <img id="previewNewImage" src="#" style="width: 150px; height: 100px; object-fit: cover; border-radius: 8px;">
            </div>
            <div class="form-group">
                <input type="submit" value="Tạo" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Quay lại danh sách</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function() {
            $('form').on('submit', function(e) {
                console.log('Form submitted');
                if (!$(this).valid()) {
                    console.log('Form validation failed');
                    e.preventDefault();
                }
            });
        });
        // Xem trước ảnh
        function previewFile(input) {
            let file = input.files[0];
            if (file) {
                // Tạo FileReader để đọc nội dung file
                let reader = new FileReader();
                reader.onload = function (e) {
                    // Lấy thẻ div và img để hiển thị ảnh xem trước
                    let previewDiv = document.getElementById("newImagePreview");
                    let previewImg = document.getElementById("previewNewImage");

                    // Gán dữ liệu ảnh vào thẻ img
                    previewImg.src = e.target.result;
                    // Hiển thị div chứa ảnh xem trước
                    previewDiv.style.display = "block";
                };
                // Đọc file dưới dạng Data URL
                reader.readAsDataURL(file);
            }
        }
    </script>
}